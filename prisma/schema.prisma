generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

// ============================================================================
// CLIENTS MODULE
// ============================================================================

model Client {
  id           String   @id @default(uuid())
  name         String
  logo         String?
  primaryColor String?  @map("primary_color")
  email        String?
  phone        String?
  active       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  users        User[]
  events       Event[]

  @@map("clients")
}

// ============================================================================
// IDENTITY MODULE
// ============================================================================

model User {
  id        String   @id // Firebase UID
  email     String   @unique
  name      String
  role      Int      @default(1) // 0 = super_admin, 1 = client_admin
  clientId  String?  @map("client_id")
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  client    Client?  @relation(fields: [clientId], references: [id])

  @@map("users")
}

// ============================================================================
// EVENTS MODULE
// ============================================================================

model Event {
  id              String      @id @default(uuid())
  clientId        String      @map("client_id")
  name            String
  slug            String      @unique
  description     String?
  maxCapacity     Int?        @map("max_capacity")
  registeredCount Int         @default(0) @map("registered_count")
  startDate       DateTime    @map("start_date")
  endDate         DateTime    @map("end_date")
  location        String?
  status          EventStatus @default(DRAFT)
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  client          Client      @relation(fields: [clientId], references: [id])
  forms           Form[]

  @@map("events")
}

enum EventStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// ============================================================================
// FORMS MODULE
// ============================================================================

model Form {
  id             String     @id @default(uuid())
  eventId        String     @map("event_id")
  name           String
  schema         Json
  basePrice      Int        @default(0) @map("base_price")
  currency       String     @default("MAD")
  successTitle   Json?      @map("success_title")
  successMessage Json?      @map("success_message")
  status         FormStatus @default(DRAFT)
  active         Boolean    @default(true)
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")

  event          Event      @relation(fields: [eventId], references: [id])

  @@map("forms")
}

enum FormStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}
